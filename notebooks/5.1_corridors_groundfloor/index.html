
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../img/logo/apidae.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.5">
    
    
      
        <title>Corridors ground floor - Project Apidae</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.21aed14c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.196e0c26.min.css">
        
          
          
          <meta name="theme-color" content="#ffc105">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Tajawal:300,400,400i,700%7C&display=fallback">
        <style>body,input{font-family:"Tajawal",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/ansi-colours.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="green">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#corridor-generation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Project Apidae" class="md-header-nav__button md-logo" aria-label="Project Apidae">
      
  <img src="../../img/logo/apidae_solo_black.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Project Apidae
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Corridors ground floor
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Project Apidae" class="md-nav__button md-logo" aria-label="Project Apidae">
      
  <img src="../../img/logo/apidae_solo_black.png" alt="logo">

    </a>
    Project Apidae
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
    <label class="md-nav__link" for="nav-3">
      A1_Planning
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="A1_Planning" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        A1_Planning
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../A1_Planning/a1_planning_process/" class="md-nav__link">
      Process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A1_Planning/a1_planning_product/" class="md-nav__link">
      Product
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
    <label class="md-nav__link" for="nav-4">
      A2_Configuring
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="A2_Configuring" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        A2_Configuring
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1" >
    <label class="md-nav__link" for="nav-4-1">
      Process
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Process" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        <span class="md-nav__icon md-icon"></span>
        Process
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../A2_Configuring/a2_configuring_Spacecriteria/" class="md-nav__link">
      Space criteria
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A2_Configuring/a2_configuring_Determiningvoxelsize/" class="md-nav__link">
      Voxelsize determination
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A2_Configuring/a2_configuring_Voxelizingthelot/" class="md-nav__link">
      Voxelizing the lattice
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A2_Configuring/a2_configuring_product/" class="md-nav__link">
      Product
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
    <label class="md-nav__link" for="nav-5">
      A3_Massing
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="A3_Massing" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        A3_Massing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1" >
    <label class="md-nav__link" for="nav-5-1">
      Process
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Process" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        <span class="md-nav__icon md-icon"></span>
        Process
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../A3_Massing/a3_configuring_intro/" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A3_Massing/a3_configuring_Spatial_Analysis/" class="md-nav__link">
      Spatial Analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A3_Massing/a3_configuring_Designing_The_Lattice/" class="md-nav__link">
      Designing the Lattice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A3_Massing/a3_configuring_shafts/" class="md-nav__link">
      Shafts and Corridors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A3_Massing/a3_configuring_ABM_Simulation/" class="md-nav__link">
      ABM Growth
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A3_Massing/a3_massing_product/" class="md-nav__link">
      Product
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" >
    <label class="md-nav__link" for="nav-6">
      A4_Forming
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="A4_Forming" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        A4_Forming
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../A4_Forming/a4_forming_process/" class="md-nav__link">
      Process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A4_Forming/a4_forming_product/" class="md-nav__link">
      Product
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Final_Deliverables/finalstuff/" class="md-nav__link">
      Final_Deliverables
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" checked>
    <label class="md-nav__link" for="nav-8">
      Index
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Index" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        Index
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-1" type="checkbox" id="nav-8-1" checked>
    <label class="md-nav__link" for="nav-8-1">
      Scripts
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Scripts" data-md-level="2">
      <label class="md-nav__title" for="nav-8-1">
        <span class="md-nav__icon md-icon"></span>
        Scripts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../1_voxelization/" class="md-nav__link">
      Voxelization highres and lowres
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2.1_lattice_sun_and_shadow/" class="md-nav__link">
      Sun and shadow analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2.2_full_lattice_sun_sky_blocking/" class="md-nav__link">
      Sun block analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3.1_lattices_skylight/" class="md-nav__link">
      Skyview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3.2_lattice_quietness/" class="md-nav__link">
      Quietness
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3.3_lattice_public_entrances/" class="md-nav__link">
      Distance calculation, Public entrances
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3.4_lattice_gym/" class="md-nav__link">
      Distance calculation, Gym entrance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3.5_lattice_parking_entrance/" class="md-nav__link">
      Distance calculation, Parking entrance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3.6_lattice_housing/" class="md-nav__link">
      Distance calculation, Housing entrance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3.7_lattice_comcen_entrance/" class="md-nav__link">
      Distance calculation, Comunity Center entrance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4_full_lattice_minus_greenery/" class="md-nav__link">
      Full lattice
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Corridors ground floor
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Corridors ground floor
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-initialization" class="md-nav__link">
    0. Initialization
  </a>
  
    <nav class="md-nav" aria-label="0. Initialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#01-load-required-libraries" class="md-nav__link">
    0.1. Load required libraries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#02-define-the-neighborhood-stencil" class="md-nav__link">
    0.2. Define the Neighborhood (Stencil)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#03-load-the-envelope-lattice-as-the-avialibility-lattice" class="md-nav__link">
    0.3. Load the envelope lattice as the avialibility lattice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#04-load-agents-information" class="md-nav__link">
    0.4. Load Agents Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#05-initialize-environment-information-layers-from-sun-access-lattice-and-entrance-access-lattice" class="md-nav__link">
    0.5. Initialize environment information layers from Sun Access Lattice and Entrance Access Lattice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-initial-agent-localisation" class="md-nav__link">
    1.1. initial agent localisation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-visualizing-the-simulation" class="md-nav__link">
    1.2. Visualizing the simulation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-for-each-seed-generate-a-shaft-location" class="md-nav__link">
    1.3. for each seed, generate a shaft location
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-compute-a-distance-graph" class="md-nav__link">
    1.5. Compute a distance graph
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-construct-the-corridors-based-on-the-shortest-paths" class="md-nav__link">
    1.6. construct the corridors based on the shortest paths
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-saving-lattice-frames-in-csv" class="md-nav__link">
    2.3. Saving lattice frames in CSV
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#credits" class="md-nav__link">
    Credits
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../5.2_corridors_upper_floors/" class="md-nav__link">
      Corridors upper floor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../5.3_shafts/" class="md-nav__link">
      Shafts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../6.1_lattice_distance_community/" class="md-nav__link">
      Distance calculation, ground floor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../6.2_lattice_distance_upper_floors/" class="md-nav__link">
      Distance calculation, upper floors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../7_ABM_growth/" class="md-nav__link">
      Agent Based Model growth simulation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../8_polygonization/" class="md-nav__link">
      Polygonization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index/figures/" class="md-nav__link">
      Figures
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index/presentations/" class="md-nav__link">
      Presentations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index/bibliography/" class="md-nav__link">
      Bibliography
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../quotes/" class="md-nav__link">
      Quotes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../reflection/" class="md-nav__link">
      Reflection
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-initialization" class="md-nav__link">
    0. Initialization
  </a>
  
    <nav class="md-nav" aria-label="0. Initialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#01-load-required-libraries" class="md-nav__link">
    0.1. Load required libraries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#02-define-the-neighborhood-stencil" class="md-nav__link">
    0.2. Define the Neighborhood (Stencil)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#03-load-the-envelope-lattice-as-the-avialibility-lattice" class="md-nav__link">
    0.3. Load the envelope lattice as the avialibility lattice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#04-load-agents-information" class="md-nav__link">
    0.4. Load Agents Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#05-initialize-environment-information-layers-from-sun-access-lattice-and-entrance-access-lattice" class="md-nav__link">
    0.5. Initialize environment information layers from Sun Access Lattice and Entrance Access Lattice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-initial-agent-localisation" class="md-nav__link">
    1.1. initial agent localisation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-visualizing-the-simulation" class="md-nav__link">
    1.2. Visualizing the simulation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-for-each-seed-generate-a-shaft-location" class="md-nav__link">
    1.3. for each seed, generate a shaft location
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-compute-a-distance-graph" class="md-nav__link">
    1.5. Compute a distance graph
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-construct-the-corridors-based-on-the-shortest-paths" class="md-nav__link">
    1.6. construct the corridors based on the shortest paths
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-saving-lattice-frames-in-csv" class="md-nav__link">
    2.3. Saving lattice frames in CSV
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#credits" class="md-nav__link">
    Credits
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
(function() {
  function addWidgetsRenderer() {
    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var scriptElement = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    scriptElement.src = widgetRendererSrc;
    document.body.appendChild(scriptElement);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="corridor-generation">Corridor generation</h1>
<p>In this notebook, the location of the corridors is being generated based on the voxel seeds. This for the corridors on the groundfloor, that connect al communal functions and all housing entrances. The public functions have their own entrance on street level.
For each function seed and the entrance location a shaft location is generated, and a connection is found to two of their closest shafts to generate a corridornetwork for this floor. </p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="0-initialization">0. Initialization</h2>
<h3 id="01-load-required-libraries">0.1. Load required libraries</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">topogenesis</span> <span class="k">as</span> <span class="nn">tg</span>
<span class="kn">import</span> <span class="nn">pyvista</span> <span class="k">as</span> <span class="nn">pv</span>
<span class="kn">import</span> <span class="nn">trimesh</span> <span class="k">as</span> <span class="nn">tm</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">copy</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># extra import function</span>
<span class="k">def</span> <span class="nf">lattice_from_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="c1"># read metadata</span>
    <span class="n">meta_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">meta_df</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">])</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">meta_df</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">])</span>
    <span class="n">minbound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">meta_df</span><span class="p">[</span><span class="s1">&#39;minbound&#39;</span><span class="p">])</span>

    <span class="c1"># read lattice</span>
    <span class="n">lattice_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># create the buffer</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lattice_df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># create the lattice</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">to_lattice</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">minbound</span><span class="o">=</span><span class="n">minbound</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">l</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="02-define-the-neighborhood-stencil">0.2. Define the Neighborhood (Stencil)</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># creating neighborhood definition</span>
<span class="n">s_1</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">create_stencil</span><span class="p">(</span><span class="s2">&quot;von_neumann&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># setting the center to zero</span>
<span class="n">s_1</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># creating neighborhood definition</span>
<span class="n">s_2</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">create_stencil</span><span class="p">(</span><span class="s2">&quot;von_neumann&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># setting the center to zero</span>
<span class="n">s_2</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">s_2</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">s_2</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">s_2</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">s_2</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># setting the center to zero</span>
<span class="n">s_2</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># creating neighborhood definition</span>
<span class="n">s_3</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">create_stencil</span><span class="p">(</span><span class="s2">&quot;von_neumann&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1"># setting the center to zero</span>
<span class="n">s_3</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">s_3</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">s_3</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">s_3</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">s_3</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># setting the center to zero</span>
<span class="n">s_3</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># creating neighborhood definition</span>
<span class="n">s_groundfloor</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">create_stencil</span><span class="p">(</span><span class="s2">&quot;von_neumann&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># setting the center to zero</span>
<span class="n">s_groundfloor</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">s_groundfloor</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">s_groundfloor</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">stencils</span> <span class="o">=</span> <span class="p">[</span><span class="n">s_1</span><span class="p">,</span> <span class="n">s_2</span><span class="p">,</span> <span class="n">s_3</span><span class="p">,</span> <span class="n">s_groundfloor</span><span class="p">]</span>

<span class="n">h_stencil</span> <span class="o">=</span> <span class="n">s_groundfloor</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="03-load-the-envelope-lattice-as-the-avialibility-lattice">0.3. Load the envelope lattice as the avialibility lattice</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># loading the lattice from csv</span>
<span class="n">lattice_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/highres_envelope.csv&#39;</span><span class="p">)</span>
<span class="n">avail_lattice</span> <span class="o">=</span> <span class="n">lattice_from_csv</span><span class="p">(</span><span class="n">lattice_path</span><span class="p">)</span>

<span class="c1"># loading the lattice from csv</span>
<span class="n">lattice_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/avail_lattice_good_voxels.csv&#39;</span><span class="p">)</span>
<span class="n">avail_lattice_good_voxels</span> <span class="o">=</span> <span class="n">lattice_from_csv</span><span class="p">(</span><span class="n">lattice_path</span><span class="p">)</span>
<span class="n">init_avail_lattice</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">to_lattice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">avail_lattice_good_voxels</span><span class="p">),</span> <span class="n">avail_lattice_good_voxels</span><span class="p">)</span>

<span class="n">avail_lattice</span><span class="o">*=</span> <span class="n">avail_lattice_good_voxels</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="04-load-agents-information">0.4. Load Agents Information</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># loading program (agents information) from CSV</span>
<span class="n">prgm_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/program_exported.csv&#39;</span><span class="p">)</span>
<span class="n">agn_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/program_exported.csv&#39;</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<span class="n">agn_ids</span> <span class="o">=</span> <span class="n">agn_info</span><span class="p">[</span><span class="s2">&quot;space_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">agn_prefs</span> <span class="o">=</span> <span class="n">agn_info</span>
<span class="n">a_pref</span> <span class="o">=</span> <span class="n">agn_prefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># Loading program information between agents from CSV</span>
<span class="n">matrix_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/program_exported_matrix.csv&#39;</span><span class="p">)</span>
<span class="n">matrix_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/program_exported_matrix.csv&#39;</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<span class="n">matrix_ids</span> <span class="o">=</span> <span class="n">matrix_info</span><span class="p">[</span><span class="s2">&quot;space_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">matrix_prefs</span> <span class="o">=</span> <span class="n">matrix_info</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="05-initialize-environment-information-layers-from-sun-access-lattice-and-entrance-access-lattice">0.5. Initialize environment information layers from Sun Access Lattice and Entrance Access Lattice</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># loading the lattice from csv</span>
<span class="n">sun_acc_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/sun_access_highres.csv&#39;</span><span class="p">)</span>
<span class="n">sun_acc_lattice</span> <span class="o">=</span> <span class="n">lattice_from_csv</span><span class="p">(</span><span class="n">sun_acc_path</span><span class="p">)</span>

<span class="n">ent_acc_highres_public_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/ent_access_highres_public.csv&#39;</span><span class="p">)</span>
<span class="n">ent_acc_public_lattice</span> <span class="o">=</span> <span class="n">lattice_from_csv</span><span class="p">(</span><span class="n">ent_acc_highres_public_path</span><span class="p">)</span>

<span class="n">ent_acc_highres_housing_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/ent_access_highres_housing.csv&#39;</span><span class="p">)</span>
<span class="n">ent_acc_housing_lattice</span> <span class="o">=</span> <span class="n">lattice_from_csv</span><span class="p">(</span><span class="n">ent_acc_highres_housing_path</span><span class="p">)</span>

<span class="n">ent_acc_highres_gym_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/ent_access_highres_gym.csv&#39;</span><span class="p">)</span>
<span class="n">ent_acc_gym_lattice</span> <span class="o">=</span> <span class="n">lattice_from_csv</span><span class="p">(</span><span class="n">ent_acc_highres_gym_path</span><span class="p">)</span>

<span class="n">ent_acc_highres_parking_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/ent_access_highres_parking.csv&#39;</span><span class="p">)</span>
<span class="n">ent_acc_parking_lattice</span> <span class="o">=</span> <span class="n">lattice_from_csv</span><span class="p">(</span><span class="n">ent_acc_highres_parking_path</span><span class="p">)</span>

<span class="n">ent_acc_highres_comcen_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/ent_access_highres_comcen.csv&#39;</span><span class="p">)</span>
<span class="n">ent_acc_comcen_lattice</span> <span class="o">=</span> <span class="n">lattice_from_csv</span><span class="p">(</span><span class="n">ent_acc_highres_comcen_path</span><span class="p">)</span>

<span class="n">highres_sky_acc_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/sky_access_highres.csv&#39;</span><span class="p">)</span>
<span class="n">sky_acc_lattice</span> <span class="o">=</span> <span class="n">lattice_from_csv</span><span class="p">(</span><span class="n">highres_sky_acc_path</span><span class="p">)</span>

<span class="n">highres_quietness_acc_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/quietness_highres.csv&#39;</span><span class="p">)</span>
<span class="n">quietness_acc_lattice</span> <span class="o">=</span> <span class="n">lattice_from_csv</span><span class="p">(</span><span class="n">highres_quietness_acc_path</span><span class="p">)</span>

<span class="n">groundfloor_acc_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/ent_access_highres_groundfloor.csv&#39;</span><span class="p">)</span>
<span class="n">groundfloor_acc_lattice</span> <span class="o">=</span> <span class="n">lattice_from_csv</span><span class="p">(</span><span class="n">groundfloor_acc_path</span><span class="p">)</span>

<span class="c1"># list the environment information layers (lattices)</span>
<span class="n">env_info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sun_acc&quot;</span><span class="p">:</span> <span class="n">sun_acc_lattice</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span>
            <span class="s2">&quot;ent_acc_public&quot;</span><span class="p">:</span> <span class="n">ent_acc_public_lattice</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> 
            <span class="s2">&quot;ent_acc_housing&quot;</span><span class="p">:</span> <span class="n">ent_acc_housing_lattice</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> 
            <span class="s2">&quot;ent_acc_gym&quot;</span><span class="p">:</span> <span class="n">ent_acc_gym_lattice</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span>
            <span class="s2">&quot;ent_acc_parking&quot;</span><span class="p">:</span> <span class="n">ent_acc_parking_lattice</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> 
            <span class="s2">&quot;ent_acc_comcen&quot;</span><span class="p">:</span> <span class="n">ent_acc_comcen_lattice</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span>
            <span class="s2">&quot;sky_acc&quot;</span><span class="p">:</span> <span class="n">sky_acc_lattice</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span>
            <span class="s2">&quot;quietness_acc&quot;</span><span class="p">:</span> <span class="n">quietness_acc_lattice</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span>
            <span class="s2">&quot;ground_floor_acc&quot;</span><span class="p">:</span> <span class="n">groundfloor_acc_lattice</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">}</span>

<span class="c1"># defining other factors in csv</span>
<span class="c1"># defining stencil id</span>
<span class="n">stencil_id</span> <span class="o">=</span> <span class="n">stencils</span>
<span class="c1"># area to use in simulation</span>
<span class="n">room_area</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># generate a list of all communal functions</span>
<span class="n">community</span> <span class="o">=</span> <span class="p">[]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">agn_info</span><span class="p">[</span><span class="s2">&quot;ent_acc_comcen&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">agn_ids</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">agn_info</span><span class="p">[</span><span class="s2">&quot;ent_acc_comcen&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

        <span class="n">community</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agn_ids</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">community</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="11-initial-agent-localisation">1.1. initial agent localisation</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">check_avail</span><span class="p">(</span><span class="n">avail_lattice</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">a_stencil_id</span><span class="p">):</span>
    <span class="n">condition</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ind_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a_stencil_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">new_ind_array</span> <span class="o">=</span> <span class="n">ind_array</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">step</span><span class="p">])</span>
        <span class="n">condition</span> <span class="o">*=</span> <span class="n">avail_lattice</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">new_ind_array</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">condition</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">eval_voxel</span><span class="p">(</span><span class="n">vox</span><span class="p">,</span> <span class="n">env_info</span><span class="p">,</span> <span class="n">a_pref</span><span class="p">):</span>
    <span class="n">global_vox_value</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="c1"># for every lattice in the environment informations</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">info_lattice</span> <span class="ow">in</span> <span class="n">env_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Here we utilise Fuzzy Logics to be able to compare different layers </span>
        <span class="c1"># of environmental information and evaluate the voxel for the agent. </span>
        <span class="c1"># This method is introduced, and generalised in Pirouz Nourian dissertation: </span>
        <span class="c1"># section 5.7.3, pp. 201-208, eq. 57. You can refer to this section for </span>
        <span class="c1"># comprehensive mathematical details.</span>
        <span class="n">vox_val</span> <span class="o">=</span> <span class="n">info_lattice</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">vox</span><span class="p">)]</span>
        <span class="n">agn_vox_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">vox_val</span><span class="p">,</span> <span class="n">a_pref</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="n">global_vox_value</span> <span class="o">*=</span> <span class="n">agn_vox_val</span>

    <span class="k">return</span> <span class="n">global_vox_value</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">mult_occupation</span><span class="p">(</span><span class="n">selected_vox_3d_address</span><span class="p">,</span> <span class="n">a_id</span><span class="p">,</span> <span class="n">a_height</span><span class="p">,</span> <span class="n">agn_locs</span><span class="p">,</span> <span class="n">agn_src_locs</span><span class="p">,</span> <span class="n">occ_lattice</span><span class="p">,</span> <span class="n">avail_lattice</span><span class="p">,</span> <span class="n">departure</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a_height</span><span class="p">):</span>

        <span class="n">new_address</span> <span class="o">=</span> <span class="n">selected_vox_3d_address</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">step</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">new_address</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">occ_lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="c1"># make tuple of the address</span>
            <span class="n">selected_vox_3d_id</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">new_address</span><span class="p">)</span>
            <span class="c1"># find the location of the newly selected voxel</span>
            <span class="n">selected_vox_loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">selected_vox_3d_id</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">departure</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
                <span class="c1"># add the newly selected voxel location to agent locations</span>
                <span class="n">agn_locs</span><span class="p">[</span><span class="n">a_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selected_vox_loc</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">step</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">agn_src_locs</span><span class="p">[</span><span class="n">a_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selected_vox_loc</span><span class="p">)</span>
                <span class="c1"># set the newly selected voxel as UNavailable (0) in the availability lattice</span>
                <span class="n">avail_lattice</span><span class="p">[</span><span class="n">selected_vox_3d_id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># set the newly selected voxel as OCCUPIED by current agent </span>
                <span class="c1"># (-1 means not-occupied so a_id)</span>
                <span class="n">occ_lattice</span><span class="p">[</span><span class="n">selected_vox_3d_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_id</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># remove the newly selected voxel location to agent locations</span>
                <span class="n">a_locs_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span> <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">agn_locs</span><span class="p">[</span><span class="n">a_id</span><span class="p">]]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ind</span> <span class="o">=</span> <span class="n">a_locs_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">selected_vox_loc</span><span class="p">))</span>
                    <span class="n">agn_locs</span><span class="p">[</span><span class="n">a_id</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>

                    <span class="c1"># set the newly selected voxel as UNavailable (0) in the availability lattice</span>
                    <span class="n">avail_lattice</span><span class="p">[</span><span class="n">selected_vox_3d_id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="c1"># set the newly selected voxel as OCCUPIED by current agent </span>
                    <span class="c1"># (-1 means not-occupied so a_id)</span>
                    <span class="n">occ_lattice</span><span class="p">[</span><span class="n">selected_vox_3d_id</span><span class="p">]</span> <span class="o">=</span>  <span class="o">-</span><span class="mi">1</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">agn_locs</span><span class="p">,</span> <span class="n">agn_src_locs</span><span class="p">,</span> <span class="n">occ_lattice</span><span class="p">,</span> <span class="n">avail_lattice</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">find_voxels_masked</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">stencil</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
    <span class="n">vox_locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">stencil</span><span class="p">)</span> <span class="o">-</span> <span class="n">stencil</span><span class="o">.</span><span class="n">origin</span> <span class="o">+</span> <span class="n">loc</span>
    <span class="n">vox_filter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">vox_locs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">vox_locs</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">vox_locs</span><span class="p">[</span><span class="n">vox_filter</span><span class="p">])</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># initialize the occupation lattice</span>
<span class="n">occ_lattice</span> <span class="o">=</span> <span class="n">avail_lattice</span> <span class="o">*</span> <span class="mi">0</span> <span class="o">-</span> <span class="mi">1</span>

<span class="c1"># Finding the index of the available voxels in avail_lattice</span>
<span class="n">avail_flat</span> <span class="o">=</span> <span class="n">avail_lattice</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">avail_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">avail_lattice</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># count the number of spaces and intiialize an agent for each space</span>
<span class="n">agn_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">agn_info</span><span class="p">)</span>

<span class="c1"># adding the origins to the agents locations</span>
<span class="n">agn_locs</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">a_id</span> <span class="ow">in</span> <span class="n">agn_ids</span><span class="p">]</span>
<span class="n">agn_src_locs</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">a_id</span> <span class="ow">in</span> <span class="n">agn_ids</span><span class="p">]</span>
<span class="n">agn_upper</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># retrieving the initial location of each agent</span>
<span class="k">for</span> <span class="n">a_id</span> <span class="ow">in</span> <span class="n">community</span><span class="p">:</span>    
    <span class="n">voxel_vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pot_voxels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># retrieve agent preferences</span>
    <span class="n">a_pref</span> <span class="o">=</span> <span class="n">agn_prefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">a_id</span><span class="p">]</span>
    <span class="n">a_stencil_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">stencil</span> <span class="o">=</span> <span class="n">stencils</span><span class="p">[</span><span class="n">a_stencil_id</span><span class="p">]</span>
    <span class="c1"># use avail_index voxel Evaluation Loop</span>
    <span class="k">for</span> <span class="n">pot_vox</span> <span class="ow">in</span> <span class="n">avail_index</span><span class="p">:</span>         
        <span class="k">if</span> <span class="n">check_avail</span><span class="p">(</span><span class="n">avail_lattice</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">pot_vox</span><span class="p">),</span> <span class="n">a_stencil_id</span><span class="p">):</span>
            <span class="c1"># evaluate each voxel</span>
            <span class="n">vox_value</span> <span class="o">=</span> <span class="n">eval_voxel</span><span class="p">(</span><span class="n">pot_vox</span><span class="p">,</span> <span class="n">env_info</span><span class="p">,</span> <span class="n">a_pref</span><span class="p">)</span>
            <span class="c1"># add the voxel value to the list of values</span>
            <span class="n">voxel_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vox_value</span><span class="p">)</span>
            <span class="n">pot_voxels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pot_vox</span><span class="p">)</span>

    <span class="c1"># convert voxel values to numpy array</span>
    <span class="n">voxel_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">voxel_vals</span><span class="p">)</span>
    <span class="c1"># convert potential voxels to numpy array</span>
    <span class="n">pot_voxels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pot_voxels</span><span class="p">)</span>
    <span class="c1"># select the voxel with highest value </span>
    <span class="n">selected_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">voxel_vals</span><span class="p">)</span> 
    <span class="c1"># find 3D intiger index of selected voxel</span>
    <span class="n">selected_vox_3d_address</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">pot_voxels</span><span class="p">[</span><span class="n">selected_int</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="c1"># find the location of the newly selected voxel</span>
    <span class="n">agn_origins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">selected_vox_3d_address</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="c1"># Occupy the newly selected voxel in the occupation lattice</span>
    <span class="n">occ_lattice</span><span class="p">[</span><span class="n">selected_vox_3d_address</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="n">agn_locs</span><span class="p">,</span> <span class="n">agn_src_locs</span><span class="p">,</span> <span class="n">occ_lattice</span><span class="p">,</span> <span class="n">avail_lattice</span> <span class="o">=</span> <span class="n">mult_occupation</span><span class="p">(</span><span class="n">selected_vox_3d_address</span><span class="p">,</span> 
                                                                       <span class="n">a_id</span><span class="p">,</span> 
                                                                       <span class="n">a_stencil_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> 
                                                                       <span class="n">agn_locs</span><span class="p">,</span>
                                                                       <span class="n">agn_src_locs</span><span class="p">,</span>
                                                                       <span class="n">occ_lattice</span><span class="p">,</span> 
                                                                       <span class="n">avail_lattice</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># add entrance voxel to the occ_lattice</span>
<span class="n">occ_lattice</span><span class="p">[(</span><span class="mi">83</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">9</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="12-visualizing-the-simulation">1.2. Visualizing the simulation</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">p</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">base_lattice</span> <span class="o">=</span> <span class="n">occ_lattice</span>

<span class="c1"># Set the grid dimensions: shape + 1 because we want to inject our values on the CELL data</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">UniformGrid</span><span class="p">()</span>
<span class="n">grid</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base_lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="c1"># The bottom left corner of the data set</span>
<span class="n">grid</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">base_lattice</span><span class="o">.</span><span class="n">minbound</span> <span class="o">-</span> <span class="n">base_lattice</span><span class="o">.</span><span class="n">unit</span> <span class="o">*</span> <span class="mf">0.5</span>
<span class="c1"># These are the cell sizes along each axis</span>
<span class="n">grid</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="n">base_lattice</span><span class="o">.</span><span class="n">unit</span> 

<span class="c1"># adding the boundingbox wireframe</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">outline</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Domain&quot;</span><span class="p">)</span>

<span class="c1"># adding the avilability lattice</span>

<span class="c1"># adding axes</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_axes</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">show_bounds</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="s2">&quot;back&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;back&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#aaaaaa&quot;</span><span class="p">)</span>

<span class="n">agn_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">agn_info</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_mesh</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">lattice</span> <span class="o">=</span> <span class="n">base_lattice</span>

    <span class="c1"># Add the data values to the cell data</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">cell_arrays</span><span class="p">[</span><span class="s2">&quot;Agents&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># Flatten the array!</span>
    <span class="c1"># filtering the voxels</span>
    <span class="n">threshed</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">threshold</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
    <span class="c1"># adding the voxels</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">threshed</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sphere&#39;</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span>

<span class="n">p</span><span class="o">.</span><span class="n">add_slider_widget</span><span class="p">(</span><span class="n">create_mesh</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;always&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;classic&quot;</span><span class="p">,</span> <span class="n">pointa</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">pointb</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
<span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">use_ipyvtk</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#saving and plotting</span>
<span class="n">png_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../screenshots/5.1_voxel_seeds_groundfloor.png&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">screenshot</span><span class="o">=</span> <span class="n">png_path</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>save the ground floor latice to csv 
csv_path = os.path.relpath('../data/voxel_seeds.csv')
occ_lattice.to_csv(csv_path)</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="13-for-each-seed-generate-a-shaft-location">1.3. for each seed, generate a shaft location</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">occupation_01_lattice</span> <span class="o">=</span> <span class="p">(</span><span class="n">occ_lattice</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="c1"># compute the sum over the columns to add weight to locations that might have multiple seeds above eachother</span>
<span class="n">column_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">occupation_01_lattice</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">max_value_seeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">column_sum</span><span class="p">)</span>
<span class="n">filled_col_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value_seeds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span> 
    <span class="c1"># find adresses of columns</span>
    <span class="n">column_adress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">column_sum</span> <span class="o">==</span> <span class="n">i</span> <span class="p">)</span>
    <span class="n">filled_collumns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">column_adress</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">filled_col_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filled_collumns</span><span class="p">)</span>

<span class="n">fill_col_stacked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">filled_col_list</span><span class="p">)</span> 
<span class="n">clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fill_col_stacked</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">clusters</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fill_col_stacked</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">col_labels</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">labels_</span>
<span class="n">cluster_centers</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># creating an empty occ lattice</span>
<span class="n">cluster_lattice</span> <span class="o">=</span> <span class="n">occ_lattice</span> <span class="o">*</span> <span class="mi">0</span> <span class="o">-</span> <span class="mi">1</span>
<span class="c1"># iterating over each filled column</span>
<span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">lab</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">fill_col_stacked</span><span class="p">,</span> <span class="n">col_labels</span><span class="p">):</span>
    <span class="c1"># setting the base of the column into the label value</span>
    <span class="n">cluster_lattice</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">lab</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="15-compute-a-distance-graph">1.5. Compute a distance graph</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">rounded_cluster_centres</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">cluster_centers</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">shaft_lattice</span> <span class="o">=</span> <span class="n">occ_lattice</span> <span class="o">*</span> <span class="mi">0</span> 
<span class="c1"># iterating over each shaft</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cen</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rounded_cluster_centres</span><span class="p">):</span> 
        <span class="n">shaft_lattice</span><span class="p">[</span><span class="n">cen</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cen</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">trimmed_shft_latice</span> <span class="o">=</span> <span class="n">shaft_lattice</span> <span class="o">*</span> <span class="n">init_avail_lattice</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># find the number of all voxels</span>
<span class="n">vox_count</span> <span class="o">=</span> <span class="n">avail_lattice</span><span class="o">.</span><span class="n">size</span> 

<span class="c1"># initialize the adjacency matrix</span>
<span class="n">adj_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Finding the index of the available voxels in avail_lattice</span>
<span class="n">avail_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">avail_lattice</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># fill the adjacency matrix using the list of all neighbours</span>
<span class="k">for</span> <span class="n">vox_loc</span> <span class="ow">in</span> <span class="n">avail_index</span><span class="p">:</span>
    <span class="c1"># find the 1D id</span>
    <span class="n">vox_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel_multi_index</span><span class="p">(</span><span class="n">vox_loc</span><span class="p">,</span> <span class="n">avail_lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="c1"># check whether it is in a shaft or not</span>
    <span class="k">if</span> <span class="n">shaft_lattice</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">vox_loc</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># in case that specific voxel is in a shaft</span>
        <span class="n">vox_stencil</span> <span class="o">=</span> <span class="n">stencil</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="c1"># in case that the voxel is a normal voxel</span>
        <span class="n">vox_stencil</span> <span class="o">=</span> <span class="n">h_stencil</span>

    <span class="c1"># retrieve the list of neighbours of the voxel based on the stencil</span>
    <span class="n">vox_neighs</span> <span class="o">=</span> <span class="n">avail_lattice</span><span class="o">.</span><span class="n">find_neighbours_masked</span><span class="p">(</span><span class="n">vox_stencil</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">vox_loc</span><span class="p">)</span>
    <span class="c1"># iterating over the neighbours</span>
    <span class="k">for</span> <span class="n">neigh</span> <span class="ow">in</span> <span class="n">vox_neighs</span><span class="p">:</span>
        <span class="c1"># setting the entry to one</span>
        <span class="c1"># adj_mtrx[vox_id, neigh] = 1.0</span>
        <span class="n">adj_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">vox_id</span><span class="p">,</span> <span class="n">neigh</span><span class="p">])</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">adj_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">adj_list</span><span class="p">)</span>
<span class="n">adj_mtrx_sparse</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">adj_array</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],(</span><span class="n">adj_array</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">adj_array</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">vox_count</span><span class="p">,</span> <span class="n">vox_count</span><span class="p">))</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">g</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_scipy_sparse_matrix</span><span class="p">(</span><span class="n">adj_mtrx_sparse</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="16-construct-the-corridors-based-on-the-shortest-paths">1.6. construct the corridors based on the shortest paths</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">corridor_lattice</span> <span class="o">=</span> <span class="n">occ_lattice</span> <span class="o">*</span> <span class="mi">0</span> <span class="o">-</span><span class="mi">1</span>

<span class="n">corr_flat</span> <span class="o">=</span> <span class="n">corridor_lattice</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">cor_groundfloor</span> <span class="o">=</span> <span class="n">shaft_lattice</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">shaft_vox_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cor_groundfloor</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="n">corr_latt_shape</span> <span class="o">=</span> <span class="n">corridor_lattice</span><span class="o">.</span><span class="n">shape</span>        

<span class="n">all_shortest_paths</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># find the shortest path between all locations to generate a corridor network</span>
<span class="k">for</span> <span class="n">start_shaft</span> <span class="ow">in</span>  <span class="n">shaft_vox_inds</span><span class="p">:</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">path_lenghts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dist_shaft_ind</span> <span class="ow">in</span> <span class="n">shaft_vox_inds</span><span class="p">:</span> 
        <span class="c1"># construct the destination adress</span>
        <span class="n">src_vox</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">start_shaft</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">start_shaft</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">dst_vox</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dist_shaft_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dist_shaft_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
        <span class="c1"># construct 1-dimentional indices</span>
        <span class="n">src_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel_multi_index</span><span class="p">(</span><span class="n">src_vox</span><span class="p">,</span> <span class="n">corr_latt_shape</span><span class="p">)</span>
        <span class="n">dst_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel_multi_index</span><span class="p">(</span><span class="n">dst_vox</span><span class="p">,</span> <span class="n">corr_latt_shape</span><span class="p">)</span>
        <span class="c1"># find the shortest path</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="n">path</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">shortest_paths</span><span class="o">.</span><span class="n">astar</span><span class="o">.</span><span class="n">astar_path</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">src_ind</span><span class="p">,</span> <span class="n">dst_ind</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> 
                <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">path_lenghts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="k">pass</span>

    <span class="n">path_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">path_lenghts</span><span class="p">))</span>
    <span class="n">shortest_path</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="n">path_order</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">all_shortest_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>

<span class="n">corridor_lattice</span> <span class="o">=</span> <span class="n">corr_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">corridor_lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># copy the corridors to all voxels that should make use of these corridors (3 voxels heigh for first level, two voxels heigh for second level)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_shortest_paths</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">cen</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span> 
        <span class="n">thrd_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">cen</span><span class="p">,</span> <span class="n">corridor_lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">corridor_lattice</span><span class="p">[</span><span class="n">thrd_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">thrd_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">corridor_lattice</span><span class="p">[</span><span class="n">thrd_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">thrd_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">p</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">base_lattice</span> <span class="o">=</span> <span class="n">corridor_lattice</span>

<span class="c1"># Set the grid dimensions: shape + 1 because we want to inject our values on the CELL data</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">UniformGrid</span><span class="p">()</span>
<span class="n">grid</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base_lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="c1"># The bottom left corner of the data set</span>
<span class="n">grid</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">base_lattice</span><span class="o">.</span><span class="n">minbound</span> <span class="o">-</span> <span class="n">base_lattice</span><span class="o">.</span><span class="n">unit</span> <span class="o">*</span> <span class="mf">0.5</span>
<span class="c1"># These are the cell sizes along each axis</span>
<span class="n">grid</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="n">base_lattice</span><span class="o">.</span><span class="n">unit</span> 

<span class="c1"># adding the boundingbox wireframe</span>

<span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">outline</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Domain&quot;</span><span class="p">)</span>

<span class="c1"># adding the avilability lattice</span>
<span class="c1"># init_avail_lattice.fast_vis(p)</span>

<span class="c1"># adding axes</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_axes</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">show_bounds</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="s2">&quot;back&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;back&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#aaaaaa&quot;</span><span class="p">)</span>




<span class="c1"># Add the data values to the cell data</span>
<span class="n">grid</span><span class="o">.</span><span class="n">cell_arrays</span><span class="p">[</span><span class="s2">&quot;Agents&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_lattice</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># Flatten the array!</span>
<span class="c1"># filtering the voxels</span>
<span class="n">threshed</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">threshold</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="c1"># adding the voxels</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">threshed</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sphere&#39;</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># p.add_slider_widget(create_mesh, [0, n_frames], title=&#39;Time&#39;, value=0, event_type=&quot;always&quot;, style=&quot;classic&quot;, pointa=(0.1, 0.1), pointb=(0.9, 0.1))</span>
<span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">use_ipyvtk</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#saving and plotting</span>
<span class="n">png_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../screenshots/5.2_corridors_groundfloor.png&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">screenshot</span><span class="o">=</span> <span class="n">png_path</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="23-saving-lattice-frames-in-csv">2.3. Saving lattice frames in CSV</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># save the ground floor latice to csv </span>
<span class="n">csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/corridors_groundfloor.csv&#39;</span><span class="p">)</span>
<span class="n">corridor_lattice</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pickle</span>
<span class="n">lattice_pickle_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/corridors_groundfloor.p&#39;</span><span class="p">)</span>
<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">corridor_lattice</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">lattice_pickle_path</span><span class="p">,</span><span class="s2">&quot;wb&quot;</span><span class="p">))</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="credits">Credits</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Shervin Azadi and Pirouz Nourian&quot;</span>
<span class="n">__editor__</span> <span class="o">=</span> <span class="s2">&quot;Maartje Damen&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>
<span class="n">__url__</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/shervinazadi/spatial_computing_workshops&quot;</span>
<span class="n">__summary__</span> <span class="o">=</span> <span class="s2">&quot;Spatial Computing Design Studio Workshop on MCDA and Path Finding for Generative Spatial Relations&quot;</span>
</code></pre></div>



</div>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../4_full_lattice_minus_greenery/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Full lattice
              </div>
            </div>
          </a>
        
        
          <a href="../5.2_corridors_upper_floors/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Corridors upper floor
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/EdaAkaltun/spatial_computing_project_template" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.7e0ee788.min.js"></script>
      <script src="../../assets/javascripts/bundle.b3a72adc.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ['search.suggest', 'search.share', 'header.autohide'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>